---

# üöÄ Executive Summary ‚Äî SWFT Container CI/CD Pipeline

This repository contains a **secure, end-to-end CI/CD pipeline** that builds, scans, signs, analyzes, and assesses a Python FastAPI container for deployment in **Azure Government Cloud**.
The workflow is split into two main jobs:

---

## **1. Build & Security Pipeline (build-and-upload)**

This job automatically runs on **push, PR, or manual workflow dispatch** and performs the following:

### üî® **Build & Test**

* Checks out source
* Runs Python tests with coverage
* Builds a Docker image and pushes it to **Azure Container Registry (ACR)**

### üõ°Ô∏è **Security Scanning & Metadata**

The following artifacts are generated and signed with **Cosign**:

* **SBOM** (CycloneDX JSON)
* **Trivy vulnerability reports** (JSON + SARIF)
* **CodeQL database** (for later security analysis)
* **run.json** (metadata capturing build ID, commit, image digest, artifact names, etc.)

### ‚òÅÔ∏è **Uploads**

Uploads depend on two flags:

| Upload Type        | Controlled By      | Destination                         |
| ------------------ | ------------------ | ----------------------------------- |
| Azure Blob Storage | `upload_to_azure`  | `sboms`, `scans`, `runs` containers |
| GitHub Artifacts   | `upload_artifacts` | Individual artifacts per run        |

---

## **2. Final AI-Assisted Security Assessment (final-assessment)**

This job runs **after build-and-upload completes** and combines all security signals:

* Downloads Trivy + CodeQL artifacts
* Pulls latest **SonarQube** vulnerabilities via API
* Runs **SCAI CTF Engine** to merge findings and generate a final:

  ```
  final_assessment_<project>_<run>.json
  ```

### üìä Final Output Includes:

* Consolidated vulnerabilities from all tools
* AI-evaluated **risk level (Critical / High / Medium / Low)**
* Determination text explaining the risk
* Links to all uploaded artifacts (if Azure upload enabled)

The final assessment is uploaded to:

* **Azure Blob ‚Üí scans** container
* **GitHub Artifacts** (if enabled)

---

## üì¶ Blob Container Layout

| Container | Purpose                                                   |
| --------- | --------------------------------------------------------- |
| **sboms** | Stores CycloneDX SBOMs                                    |
| **scans** | Stores Trivy, CodeQL DB, SonarQube JSON, Final Assessment |
| **runs**  | Stores run.json (metadata for each pipeline run)          |


# üìõ Artifact Naming Conventions

All artifacts produced by the pipeline follow a consistent naming pattern based on two components:

* **`<project>`** ‚Äî comes from `PROJECT_NAME`
* **`<run>`** ‚Äî comes from GitHub `RUN_ID` (unique per workflow run)

The general pattern is:

```
<project>-<run>-<artifact-type>.<ext>
```

Where `<artifact-type>` maps to SBOM, Trivy, SARIF, CodeQL DB, and run metadata.

---

# üìÑ File-by-File Naming Convention

## **1. SBOM Source File (CycloneDX JSON)**

**Generated by Syft / SBOM Action**

```
<project>-<run>-sbom.cyclonedx.json
```

Example:

```
swft-demo-19720990653-sbom.cyclonedx.json
```

---

## **2. Trivy JSON Report**

```
<project>-<run>-trivy-report.json
```

Example:

```
swft-demo-19720990653-trivy-report.json
```

---

## **3. Trivy SARIF Report**

```
<project>-<run>-trivy-results.sarif
```

Example:

```
swft-demo-19720990653-trivy-results.sarif
```

---

## **4. CodeQL Database Bundle**

```
<project>-<run>-codeql-db.tar.gz
```

Example:

```
swft-demo-19720990653-codeql-db.tar.gz
```

---

## **5. run.json Metadata File**

This contains full traceability: image digest, artifact filenames, URLs, etc.

```
<project>-<run>-run.json
```

Example:

```
swft-demo-19720990653-run.json
```

---

## **6. GitHub Artifact Upload Names**

These use descriptive prefixes plus the `<project>` and `<run>`:

| Artifact Type    | GitHub Artifact Name               |
| ---------------- | ---------------------------------- |
| SBOM             | `sbom-<project>-<run>`             |
| Trivy JSON       | `trivy-json-<project>-<run>`       |
| Trivy SARIF      | `trivy-sarif-<project>-<run>`      |
| CodeQL DB        | `codeql-database-<project>-<run>`  |
| CodeQL SARIF     | `codeql-sarif-<project>-<run>`     |
| Run JSON         | `swft-run-json-<project>-<run>`    |
| Final Assessment | `final-assessment-<project>-<run>` |

Examples:

```
sbom-swft-demo-19720990653
trivy-json-swft-demo-19720990653
codeql-database-swft-demo-19720990653
final-assessment-swft-demo-19720990653
```

---

## **7. Final Assessment JSON (Generated by SCAI CTF Engine)**

Stored in `security-reports/` during CI, then uploaded with:

```
final_assessment_<project>_<run>.json
```

Example:

```
final_assessment_swft-demo_19720990653.json
```

---

# üì¶ Azure Blob Storage Naming

Uploads use **flat filenames** with no prefixing folders:

| Container | Artifact Name Pattern                                                |
| --------- | -------------------------------------------------------------------- |
| `sboms`   | `<project>-<run>-sbom.cyclonedx.json`                                |
| `scans`   | Trivy JSON, Trivy SARIF, CodeQL DB, SonarQube JSON, Final Assessment |
| `runs`    | `<project>-<run>-run.json`                                           |

---

# üß© Summary Table (Quick Reference)

| Artifact              | Naming Pattern                          | Example                                       |
| --------------------- | --------------------------------------- | --------------------------------------------- |
| SBOM                  | `<project>-<run>-sbom.cyclonedx.json`   | `swft-demo-19720990653-sbom.cyclonedx.json`   |
| Trivy JSON            | `<project>-<run>-trivy-report.json`     | `swft-demo-19720990653-trivy-report.json`     |
| Trivy SARIF           | `<project>-<run>-trivy-results.sarif`   | `swft-demo-19720990653-trivy-results.sarif`   |
| CodeQL DB             | `<project>-<run>-codeql-db.tar.gz`      | `swft-demo-19720990653-codeql-db.tar.gz`      |
| run.json              | `<project>-<run>-run.json`              | `swft-demo-19720990653-run.json`              |
| Final Assessment      | `final_assessment_<project>_<run>.json` | `final_assessment_swft-demo_19720990653.json` |
| GitHub Artifact Names | `type-<project>-<run>`                  | `trivy-json-swft-demo-19720990653`            |

